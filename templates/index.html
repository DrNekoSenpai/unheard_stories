[[extend 'layout.html']]

<!-- vue access div -->
<div class="section" id="vue-target">

  <!-- add story html toggle block -->
  <div v-if="add_mode" class="container block">
    <!-- Title Input Field -->
    <div class="field">
      <label class="label">Title:</label>
      <div class="control">
        <input type="text" v-model="add_title" class="input" />
      </div>
    </div>

    <!-- Contents Input Field -->
    <div class="field">
      <label class="label">Contents:</label>
      <div class="control">
        <textarea v-model="add_content" class="textarea"></textarea>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="field">
      <div class="control">
        <input
          type="submit"
          @click="add_story"
          value="Add"
          class="button is-primary"
        />
        <input
          type="submit"
          @click="set_feed_mode()"
          value="Back"
          class="button is-warning"
        />
      </div>
    </div>
  </div>

  <!-- view story html toggle block -->
  <div v-if="view_mode" class="container block">
    <!-- Title -->
    <div class="block">
      <div class="title is-2">{{view_title}}</div>
    </div>
    <!-- details -->
    <div class="block">
      <div class="subtitle is-6">
        by {{view_author}}, Created on {{view_date}}
      </div>
    </div>
    <!-- content -->
    <div class="block">
      <div class="box">{{view_content}}</div>
    </div>
    <!-- report post button -->
    <div class="field">
      <div class="control">
        <button class="button is-danger" @click="report_post()">
          Report post
        </button>
      </div>
    </div>

    <!-- display comments block-->
    <div v-for="comment in comments" class="block">
      <div class="box">
        <nav class="level is-mobile">
          <div class="level-left">
            <a class="level-item" aria-label="reply">
              <span class="icon is-small">
                <i class="fa fa-user"></i>
              </span>
              <span class="ml-2">{{comment.author}}</span>
            </a>
          </div>
          <div class="level-right">
            <span class="level-item">{{comment.creation_date}}</span>
          </div>
        </nav>
        <div class="content">
          {{comment.content}}
        </div>
        <nav class="level is-mobile">
          <div class="level-left">
            <!-- like button -->
            <a class="level-item" aria-label="like" @click="like(comment)">
              <span class="icon is-small">
                <i class="fa fa-heart"></i>
              </span>
              <!-- likes count -->
              <span class="ml-1">{{comment.likes}}</span>
            </a>
            <!-- reply icon -->
            <!-- clicking the reply button should open up a text box -->
            <a class="level-item" aria-label="reply" 
            @click="set_reply_mode(post)">
              <span class="icon is-small" >
                <i class="fa fa-reply" aria-hidden="true"></i>
              </span>
              <!-- replies count -->
              <span class="ml-1">{{comment.replies}}</span> <!-- might cause problems -->
            </a>
            <!-- report comment button -->
            <a class="level-item" aria-label="report" @click="report_comment(comment)">
              <span class="icon is-small">
                <i class="fa fa-warning"></i>
              </span>
            </a>
          </div>
        </nav>
      </div>
    </div>

    <!-- comment box -->
    <div class="field">
      <textarea
        class="textarea"
        placeholder="Leave a comment"
        rows="2"
        v-model="add_content"
      ></textarea>
    </div>
    <div class="field">
      <div class="control">
        <button class="button is-link" @click="add_comment()">Comment</button>
      </div>
    </div>

    <!-- Back Button -->
    <input
      type="submit"
      @click="set_feed_mode()"
      value="Back"
      class="button is-warning"
    />
  </div>

  <!-- feed html toggle block -->
  <div v-if="feed_mode" class="container block">
    <div class="title">Unheard Stories</div>
    <div class="field">
      <p class="control has-icons-right">
        <input class="input" type="text" placeholder="Search stories" v-model="search" @input="get_feed(search)">
        <span class="icon is-small is-right is-clickable" @click="reset_search">
          <i class="fa fa-times-circle"></i>
        </span>
      </p>
    </div>
    <div class="container">
      <table class="table is-striped is-fullwidth">
        <!-- vue feed -->
        <div v-for="story in feed" class="block">
          <div class="box">
            <div class="columns">
              <div class="column is-11">
                <p><b>{{story.title}}</b></p>
                <p><i>by {{story.author}}</i></p>

                <!-- Display likes, dislikes, number of comments -->
                <p>
                  <span class="icon"><i class="fa fa-fw fa-heart"></i></span>
                  <span>{{story.likes}}</span>
                  <span class="icon"><i class="fa fa-fw fa-comments"></i></span>
                  <span>{{story.num_comments}}</span>
                </p>
              </div>

              <div class="column is-1">
                <!-- view button -->
                <a class="button is-success" @click="view(story._idx)">
                  <span class="icon"><i class="fa fa-fw fa-eye"></i></span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </table>
    </div>
    <a class="button is-success" @click="set_add_mode()">
      <span class="icon"><i class="fa fa-plus"></i></span>
      <span>Submit a story</span>
    </a>
  </div>
</div>

[[block page_scripts]]
<!-- This passes the python controller actions to the js -->
<script>
  let get_feed_url     = "[[=XML(get_feed_url)]]";
  let add_story_url    = "[[=XML(add_story_url)]]";
  let add_comment_url  = "[[=XML(add_comment_url)]]";
  let get_comments_url = "[[=XML(get_comments_url)]]";
</script>
<script src="js/index.js"></script>
[[end]]
